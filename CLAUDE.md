# CLAUDE.md - WebRS_MTF_Threshold

This file provides guidance for working with the WebRS MTF Threshold Streamlit application.

## Quick Start

### Virtual Environment Setup (Required)
The project uses a dedicated Python virtual environment for dependency management:

```bash
# Activate virtual environment (required for all operations)
source psychophysics_env/bin/activate  # Linux/macOS
# or
./psychophysics_env/bin/python  # Direct execution

# Verify installation
./psychophysics_env/bin/python -c "import cv2, numpy, streamlit; print('‚úÖ Dependencies available')"
```

### Local Development
```bash
# Using virtual environment directly (recommended)
./psychophysics_env/bin/python run_app.py

# Or after activating environment
source psychophysics_env/bin/activate
python run_app.py
```

### Streamlit Direct
```bash
./psychophysics_env/bin/streamlit run app.py
# or
source psychophysics_env/bin/activate && streamlit run app.py
```

### Replit Deployment
```bash
python main.py  # Uses system Python in Replit
```

## Key Commands

### Development (All commands require virtual environment)
- `./psychophysics_env/bin/python run_app.py` - Local development (recommended)
- `./psychophysics_env/bin/streamlit run app.py` - Direct Streamlit execution
- `python main.py` - Replit environment (uses system Python)

### Testing
- `./psychophysics_env/bin/python tests/test_basic.py` - Basic functionality tests
- `./psychophysics_env/bin/python tests/test_session_manager.py` - Session state tests
- `./psychophysics_env/bin/python pixel_perfect_test.py` - Image display validation

### Data Management
- `./psychophysics_env/bin/python preview_results.py` - Preview experiment results  
- `./psychophysics_env/bin/python database_manager.py` - Database operations

## Architecture

### Core Application
- `app.py` - Main Streamlit application (135 lines, refactored from 2,174)
- `run_app.py` - Local environment launcher
- `main.py` - Replit environment launcher
- `mtf_experiment.py` - MTF experiment management core

### Modular Structure
- `core/session_manager.py` - Centralized Streamlit session state management
- `core/experiment_controller.py` - Experiment flow and trial progression
- `ui/screens/` - Modular screen system (welcome, instructions, trial, results)
- `ui/components/` - Reusable UI components (buttons, progress indicators)

### Experiment System
- `experiments/ado_utils.py` - Complete ADO engine implementation
- `experiments/mtf_utils.py` - **MTF image processing utilities (v0.4 lookup table system integrated)**
- `experiments/high_dpi_utils.py` - High DPI image processing system

### Data Storage
- `database.py` - PostgreSQL/SQLite database operations
- `csv_data_manager.py` - CSV file management and backup
- `data_manager.py` - Unified data management interface

### Stimulus Preparation Tools
- `stimuli_preparation/[OE] MTF_test_v0.4.py` - Advanced MTF stimulus generation with lookup table system
- `stimuli_preparation/preprocess_mtf_images.py` - **Image preprocessing utilities (v0.4 algorithm integrated)**
- `stimuli_preparation/high_dpi/` - High DPI stimulus variants (2x, 3x scaling)

## ‚ö†Ô∏è CRITICAL: Psychophysical Experiment Requirements

### üö´ ABSOLUTE PROHIBITION: Image Scaling in Psychophysical Experiments

**NEVER scale, resize, or modify stimulus image dimensions in any way during display.**

#### Why This Is Critical:
- **Scientific Validity**: Scaling destroys the precise MTF calculations and spatial frequency relationships
- **Experimental Accuracy**: Even small scaling changes can invalidate threshold measurements
- **Reproducibility**: Results become non-comparable across different display setups
- **Research Integrity**: Scaling violates fundamental psychophysical experiment principles

#### Implementation Rules:
1. **Images must always display at 1:1 pixel ratio** - no exceptions
2. **Container sizes adapt to image dimensions**, never the reverse
3. **UI layout problems must be solved through spacing and positioning**, not image scaling
4. **All image processing functions must maintain original pixel dimensions**

#### Code Enforcement:
- `ui/components/image_display.py`: Contains safeguards against accidental scaling
- `experiments/mtf_utils.py`: Processes images without size modifications beyond cropping
- All display functions must preserve exact pixel dimensions from stimulus generation

#### If UI Layout Issues Occur:
- ‚úÖ Adjust container spacing and margins
- ‚úÖ Modify button positioning and layout
- ‚úÖ Change page layout and CSS styling
- ‚ùå **NEVER** scale or resize stimulus images

---

## Configuration

### Experiment Settings (config/settings.py)
- MAX_TRIALS: 45
- MIN_TRIALS: 15
- CONVERGENCE_THRESHOLD: 0.15
- STIMULUS_DURATION: 1.0 seconds
- PRACTICE_TRIAL_LIMIT: 1

### Environment Detection
- **Replit**: PostgreSQL, port 5000
- **Ubuntu Server**: port 3838
- **Local**: SQLite, port 8501

### High DPI System
- Directory: `stimuli_preparation/high_dpi/`
- Levels: 2x, 3x resolutions for pixel-perfect display
- Smart DPI detection and automatic optimization

### MTF Stimulus Generation Tool ([OE] MTF_test_v0.4.py)

**Version Information**: Based on MTF_test_v0.3.py provided by Tingwei (Aug. 4th), enhanced with lookup table system

**Required Configuration Parameters**:
```python
# Line 143: Output filename (without extension)
name = "your_stimulus_name"

# Line 144: Source image file path
image_path = "path/to/your/source_image.png"

# Line 145: Output directory for generated MTF images
save_path = "output/directory/"

# Line 146: Display panel size in inches
panel_size = 27

# Lines 147-148: Panel resolution
panel_resolution_H = 3840    # Horizontal resolution
panel_resolution_V = 2160    # Vertical resolution

# Line 173: List of desired MTF percentages for batch generation
test1_MTF = [80, 60, 40, 20]  # Generates images at these MTF levels
```

**Key Features**:
- **Precise MTF Calculation**: Physics-based sigma computation using optical MTF formula
- **Lookup Table System**: Pre-computed MTF-to-sigma mapping for efficiency
- **Batch Generation**: Creates multiple MTF-blurred images in single run
- **Panel-Specific Calibration**: Automatic pixel size and Nyquist frequency calculation
- **Visual Analysis**: Generates MTF curve plots with marked sigma values

**Usage**:
```bash
cd stimuli_preparation/
# Use virtual environment for standalone execution
../psychophysics_env/bin/python "[OE] MTF_test_v0.4.py"
```

**Output**:
- Individual MTF-blurred images: `{name}_{mtf_value}MTF_Blur.png`
- MTF analysis plots with sigma value annotations

## MTF Algorithm (v0.4) Integration

### üéØ MTF Lookup Table System (Latest Update)

**Major Performance Upgrade (August 2025)**:
- **üöÄ From Direct Calculation to Lookup Table**: MTF processing completely refactored from real-time formula calculation to pre-computed lookup table system
- **10-100x Performance Improvement**: Instant sigma value lookup vs. repeated mathematical computation
- **Initialization Optimization**: Lookup table pre-built during experiment initialization for maximum efficiency
- **Memory Efficient**: Global lookup table reused throughout entire experiment session

**Core Enhancements**:
- **Dynamic Parameter Calculation**: Automatic pixel size and Nyquist frequency computation based on panel specifications
- **Global Lookup Table System**: Pre-computed MTF-to-sigma mapping with 21 precision data points (100%-5%, every 5%)
- **Smart Initialization**: Automatic table building during experiment startup with parameter validation
- **Intelligent Fallback**: Seamless degradation to direct calculation if lookup table fails
- **Boundary Safety**: Automatic handling of extreme MTF values (prevents OpenCV errors)

### Key Functions (experiments/mtf_utils.py)

**New v0.4 Lookup Table Functions**:
```python
# Global lookup table management
initialize_mtf_lookup_table(pixel_size_mm=None, frequency_lpmm=None, force_rebuild=False)
get_sigma_from_mtf_lookup(mtf_percent)  # Fast O(n) lookup
get_mtf_lookup_table_info()  # Table status and diagnostics

# Dynamic parameter calculation
calculate_dynamic_mtf_parameters(panel_size=27, panel_resolution_H=3840, panel_resolution_V=2160)

# Legacy lookup table functions (still available)
sigma_vs_mtf(f_lpmm, pixel_size_mm, sigma_pixel_max=5)
lookup_sigma_from_mtf(target_table, mtf_list)

# Enhanced MTF processing with lookup table integration
apply_mtf_to_image(image, mtf_percent, use_v4_algorithm=True)  # Now uses lookup table
apply_mtf_to_image_v4(image, mtf_percent)  # Direct v0.4 usage with lookup
```

**Algorithm Evolution**:
| Feature | Legacy Algorithm | v0.4 Direct | v0.4 Lookup Table (Current) |
|---------|------------------|-------------|----------------------------|
| Pixel Size | Fixed (0.169333 mm) | Dynamic calculation | Dynamic + Cached |
| Frequency | Fixed (3.0 lp/mm) | Nyquist frequency | Nyquist + Cached |
| Processing | Direct calculation | Direct calculation | Pre-computed lookup |
| Performance | Moderate | Moderate | **10-100x faster** |
| Accuracy | Approximation | Physics-based precision | Physics-based precision |
| Memory | Low | Low | Minimal (21 data points) |
| Initialization | Instant | Instant | **Pre-built during startup** |

### Integration Points

**Main Experiment System** (`mtf_experiment.py`):
- **Automatic Lookup Table Pre-building**: MTF lookup table constructed during experiment initialization
- **Intelligent Parameter Management**: Dynamic parameter calculation with global caching
- **Performance Monitoring**: Real-time lookup table status reporting and diagnostics
- **Robust Fallback Chain**: Lookup table ‚Üí Direct v0.4 ‚Üí Legacy algorithm degradation

**Preprocessing Tools** (`preprocess_mtf_images.py`):
- v0.4 algorithm as default for batch image generation
- Performance comparison between algorithms
- Separate output directories for algorithm comparison

### Usage Examples

**Experiment Runtime**:
```python
# Automatic v0.4 usage in experiment
img_stimulus = generate_stimulus_image(mtf_value=45.0)  # Uses v0.4 by default
```

**Manual Processing**:
```python
# Direct v0.4 algorithm usage
from experiments.mtf_utils import apply_mtf_to_image_v4
img_processed = apply_mtf_to_image_v4(base_image, 30.0)

# Algorithm comparison
img_v4 = apply_mtf_to_image(base_image, 30.0, use_v4_algorithm=True)
img_legacy = apply_mtf_to_image(base_image, 30.0, use_v4_algorithm=False)
```

**Batch Processing**:
```bash
# Generate images with v0.4 lookup table algorithm
cd stimuli_preparation/
../psychophysics_env/bin/python preprocess_mtf_images.py  # Uses v0.4 lookup by default
```

### üß™ Testing Lookup Table System

**Test Basic Functionality**:
```bash
# Test lookup table initialization and performance
./psychophysics_env/bin/python -c "
from experiments.mtf_utils import initialize_mtf_lookup_table, get_mtf_lookup_table_info, get_sigma_from_mtf_lookup
import time

# Initialize lookup table
success = initialize_mtf_lookup_table()
print(f'Lookup table initialized: {success}')

# Check table info
info = get_mtf_lookup_table_info()
print(f'Table size: {info[\"table_size\"]} data points')
print(f'Parameters: pixel_size={info[\"pixel_size_mm\"]:.6f}mm, freq={info[\"frequency_lpmm\"]}lp/mm')

# Performance test
start = time.time()
for mtf in [20, 40, 60, 80]:
    sigma = get_sigma_from_mtf_lookup(mtf)
    print(f'MTF {mtf}% ‚Üí sigma = {sigma:.4f} pixels')
end = time.time()
print(f'Lookup performance: {(end-start)*1000:.2f}ms for 4 queries')
"
```

**Test Full Integration**:
```bash
# Test complete experiment system with lookup table
./psychophysics_env/bin/python -c "
from mtf_experiment import MTFExperimentManager

# Initialize experiment (will pre-build lookup table)
manager = MTFExperimentManager(max_trials=3, participant_id='lookup_test', is_practice=True)

# Generate trial (uses lookup table)
trial = manager.get_next_trial()
if trial and trial['stimulus_image'] is not None:
    print(f'‚úÖ Trial generated successfully: MTF={trial[\"mtf_value\"]:.1f}%')
    print(f'   Stimulus shape: {trial[\"stimulus_image\"].shape}')
else:
    print('‚ö†Ô∏è Trial generation issue')
"
```

## Important Notes

- **PRODUCTION READY**: v2.2 stable version with modular architecture
- **üöÄ MTF LOOKUP TABLE SYSTEM (August 2025)**: **Complete performance overhaul from direct calculation to pre-computed lookup table**
- **MTF ALGORITHM v0.4**: **Integrated advanced MTF processing with dynamic parameters and high-performance lookup system**
- **VIRTUAL ENVIRONMENT REQUIRED**: All local operations must use `./psychophysics_env/bin/python` for dependency management
- **ADO System**: Fully functional with Bayesian optimization
- **High DPI Support**: 144 DPI precision display system implemented
- **Dual Storage**: CSV + Database backup for data reliability
- **Environment Standardization**: Pixel-perfect display through controlled environment
- **Refactoring Complete**: Reduced from monolithic 2,174 lines to clean modular design
- **Performance Optimized**: 10-100x MTF processing speed improvement through lookup table system
- **Algorithm Compatibility**: Supports lookup table (default), direct v0.4, and legacy MTF processing methods

## Troubleshooting

### Virtual Environment Issues

**Common Error**: `ModuleNotFoundError: No module named 'cv2'`
```bash
# Solution: Always use virtual environment
./psychophysics_env/bin/python your_script.py  # Instead of: python your_script.py
```

**Check Dependencies**:
```bash
# Verify all required packages are installed
./psychophysics_env/bin/python -c "
import cv2, numpy, streamlit, pandas, matplotlib
print('‚úÖ All core dependencies available')
print(f'OpenCV: {cv2.__version__}')
print(f'NumPy: {numpy.__version__}')
"
```

**Lookup Table Troubleshooting**:
```bash
# Debug lookup table initialization
./psychophysics_env/bin/python -c "
from experiments.mtf_utils import initialize_mtf_lookup_table, get_mtf_lookup_table_info
import logging
logging.basicConfig(level=logging.DEBUG)

success = initialize_mtf_lookup_table(force_rebuild=True)
info = get_mtf_lookup_table_info()
print(f'Initialization: {success}')
print(f'Table info: {info}')
"
```

### Performance Monitoring

**MTF Processing Performance**:
- **Lookup Table**: ~0.1ms per MTF value
- **Direct v0.4**: ~5-10ms per MTF value  
- **Legacy Algorithm**: ~3-8ms per MTF value

**Memory Usage**:
- **Lookup Table**: ~2KB (21 data points)
- **Base Image Cache**: ~3-8MB per image
- **Total Runtime**: ~15-50MB depending on cache usage

## Documentation Links

- **[[REFACTORING_PLAN.md]]** - Technical debt management and improvement strategy
- **[[replit.md]]** - Deployment configuration and system architecture
- **[[HIGH_DPI_SETUP_GUIDE.md]]** - High DPI image system setup guide
- **[[browser_pixel_perfect_guide.md]]** - Browser optimization for pixel-perfect display
- **[[MTF_Explanation.md]]** - MTF processing principles and technical analysis
- **[[ADO_Early_Termination_Analysis.md]]** - ADO early termination feature assessment
- **[[image_test/README.md]]** - Image display testing tools

## MTF Âà∫ÊøÄÂúñÊ≠£Á¢∫ÊÄßËàáÊÄßËÉΩÂÑ™ÂåñÁ≥ªÁµ±Á∏ΩÁµê

### üéØ MTF Âà∫ÊøÄÂúñÊ≠£Á¢∫ÊÄß‰øùË≠âÁ≥ªÁµ±

#### 1. Á≤æÁ¢∫ÁöÑ MTF ÁÆóÊ≥ïÂØ¶Áèæ (v0.4 Áâ©ÁêÜÊ∫ñÁ¢∫ÊÄß)
- **ÂãïÊÖãÂèÉÊï∏Ë®àÁÆó**: Âü∫ÊñºÂØ¶ÈöõÈ°ØÁ§∫Âô®Ë¶èÊ†ºË®àÁÆóÂÉèÁ¥†Â§ßÂ∞è (pixel_size_mm) Âíå Nyquist È†ªÁéá
- **MTF Êü•Ë°®Á≥ªÁµ±**: È†êË®àÁÆó 100%-5% MTF ÂÄºËàá sigma Â∞çÊáâÈóú‰øÇ (21ÂÄãÁ≤æÁ¢∫Êï∏ÊìöÈªû)
- **Áâ©ÁêÜÂÖ¨ÂºèÂü∫Á§é**: MTF = exp(-2œÄ¬≤f¬≤œÉ¬≤) Á¢∫‰øùÂÖâÂ≠∏Ê∫ñÁ¢∫ÊÄß
- **‰∏ÄËá¥ÊÄßÈ©óË≠â**: Ëàá [OE] MTF_test_v0.4.py ÂÆåÂÖ®Áõ∏ÂêåÁöÑË®àÁÆóÈÇèËºØ

```python
# Ê†∏ÂøÉÁÆóÊ≥ïÁ¢∫‰øù MTF Ê∫ñÁ¢∫ÊÄß
pixel_size_mm = (panel_size * 25.4) / panel_resolution_D  # ÂãïÊÖãË®àÁÆóÂÉèÁ¥†Â§ßÂ∞è
nyquist_lpmm = 1/(2*pixel_size_mm)*2                      # Nyquist È†ªÁéáË®àÁÆó
sigma_mm = np.sqrt(-np.log(mtf_ratio) / (2 * (np.pi * f) ** 2))  # È´òÊñØÊ®°Á≥äÂèÉÊï∏
```

#### 2. ÂÉèÁ¥†ÂÆåÁæéÈ°ØÁ§∫‰øùË≠∑Ê©üÂà∂
- **üö´ ÁµïÂ∞çÁ¶ÅÊ≠¢ÂúñÁâáÁ∏ÆÊîæ**: ÊâÄÊúâÂúñÁâá‰ª• 1:1 ÂÉèÁ¥†ÊØî‰æãÈ°ØÁ§∫ÔºåÁ¢∫‰øùÁ©∫ÈñìÈ†ªÁéáÊ∫ñÁ¢∫ÊÄß
- **ÁÑ°ÊêçÁ∑®Á¢ºÁ≥ªÁµ±**: ‰ΩøÁî® OpenCV PNG Á∑®Á¢º (Â£ìÁ∏ÆÁ¥öÂà• 0) ÈÅøÂÖç‰ªª‰ΩïÂìÅË≥™ÊêçÂ§±
- **CSS ÂÉèÁ¥†ÂÆåÁæéË®≠ÂÆö**: `image-rendering: crisp-edges` Á¢∫‰øùÁÄèË¶ΩÂô®‰∏çÊúÉÊäóÈã∏ÈΩíËôïÁêÜ
- **ÂÆπÂô®ÈÅ©ÊáâË®≠Ë®à**: UI Â∏ÉÂ±ÄÈÅ©ÊáâÂúñÁâáÂ∞∫ÂØ∏ÔºåËÄåÈùûÂº∑Âà∂ÂúñÁâáÈÅ©ÊáâÂÆπÂô®

```python
# ÂÉèÁ¥†ÂÆåÁæéÈ°ØÁ§∫ÁöÑÈóúÈçµ‰øùË≠∑
image_style = (
    f"width: {display_width}px; "      # ÂéüÂßãÂ∞∫ÂØ∏ - Áµï‰∏çÁ∏ÆÊîæ
    f"height: {display_height}px; "    # ÂéüÂßãÂ∞∫ÂØ∏ - Áµï‰∏çÁ∏ÆÊîæ
    f"image-rendering: crisp-edges !important; "  # ÂÉèÁ¥†ÂÆåÁæéÊ∏≤Êüì
)
```

#### 3. Âà∫ÊøÄÂúñÂìÅË≥™ÊéßÂà∂ÊµÅÁ®ã
- **ËºâÂÖ•ËàáÈ†êËôïÁêÜ**: Áµ±‰∏ÄË£ÅÂàáÁÇ∫ 1200x1200 ‰∏≠ÂøÉÊ≠£ÊñπÂΩ¢ÔºåÈÅøÂÖçËÆäÂΩ¢
- **MTF ËôïÁêÜÈ©óË≠â**: ÊØèÊ¨°ËôïÁêÜÈÉΩË®òÈåÑÂéüÂúñËàáËôïÁêÜÂæåÁöÑÊï∏ÂÄºÁØÑÂúç
- **Á∑©Â≠òÂÆåÊï¥ÊÄßÊ™¢Êü•**: MTF Á∑©Â≠òÁ≥ªÁµ±Á¢∫‰øùÁõ∏ÂêåÂèÉÊï∏Áî¢ÁîüÁõ∏ÂêåÁµêÊûú
- **ÂØ¶ÊôÇÂìÅË≥™Áõ£Êéß**: Ë®òÈåÑÊØèÂÄã MTF ÂÄºÁöÑËôïÁêÜÊôÇÈñìÂíåÁµêÊûú‰∏ÄËá¥ÊÄß

### üöÄ È´òÊïàËÉΩÁ∂≤È†ÅËºâÂÖ•Á≥ªÁµ±

#### 1. Base64 È†êÁ∑®Á¢ºÂø´ÂèñÊ©üÂà∂ (Â∑≤ÂØ¶ÊñΩ)
**ÂïèÈ°åËß£Ê±∫**: Ê∂àÈô§ÊØèÊ¨°È°ØÁ§∫ÊôÇÁöÑÈáçË§áÁ∑®Á¢ºÂª∂ÈÅ≤ (1-3 Áßí ‚Üí <1ms)

```python
# ÊÄßËÉΩÂÑ™ÂåñÊ†∏ÂøÉ: Base64 È†êÁ∑®Á¢ºÂø´Âèñ
class MTFExperimentManager:
    def generate_and_cache_base64_image(self, mtf_value):
        cache_key = f"base64_{mtf_value}"
        if cache_key in self.base64_cache:  # Âø´ÂèñÂëΩ‰∏≠ <1ms
            return self.base64_cache[cache_key]
        
        # ‰∏ÄÊ¨°ÊÄßÁ∑®Á¢º‰∏¶Á∑©Â≠ò
        img_base64 = encode_to_base64_optimized(img_mtf)
        self.base64_cache[cache_key] = img_base64
        return img_base64
```

**ÊÄßËÉΩÊîπÂñÑ**:
- **Âø´ÂèñÂëΩ‰∏≠ÊôÇ**: <1ms (10-100x ÊïàËÉΩÊèêÂçá)
- **Á∑®Á¢ºÂÑ™Âåñ**: PNG Â£ìÁ∏ÆÁ¥öÂà• 0 (ÁÑ°Â£ìÁ∏ÆÔºåÊúÄÈ´òÈÄüÂ∫¶)
- **Ë®òÊÜ∂È´îÁÆ°ÁêÜ**: LRU Á∑©Â≠òÊ©üÂà∂ÔºåÊúÄÂ§ö‰øùÂ≠ò 5 ÂºµÂúñÁâá

#### 2. MTF Êü•Ë°®Á≥ªÁµ±È´òÈÄüËôïÁêÜ (v0.4 ÁÆóÊ≥ï)
**ÂàùÂßãÂåñÊôÇÈ†êÂª∫Êü•Ë°®**: ÂØ¶È©óÈñãÂßãÂâçÂÆåÊàêÊâÄÊúâ MTF-sigma Â∞çÊáâÈóú‰øÇË®àÁÆó

```python
# ÂØ¶È©óÂàùÂßãÂåñÊôÇÈ†êÂª∫Êü•Ë°® (‰∏ÄÊ¨°ÊÄßË®àÁÆó)
initialize_mtf_lookup_table(pixel_size_mm, frequency_lpmm)

# ÂØ¶È©óÊúüÈñìÂø´ÈÄüÊü•Êâæ (O(1) Ë§áÈõúÂ∫¶)
sigma_pixel = get_sigma_from_mtf_lookup(mtf_percent)
```

**ÊÄßËÉΩÁâπÂæµ**:
- **È†êÂª∫ÊôÇÈñì**: ÂØ¶È©óÂàùÂßãÂåñÊúüÈñì ~100ms
- **Êü•ÊâæÈÄüÂ∫¶**: ÊØèÊ¨° MTF Êü•Êâæ <0.1ms
- **Ë®òÊÜ∂È´îÂç†Áî®**: ÂÉÖ 21 ÂÄãÊï∏ÊìöÈªû (~2KB)
- **Ë®àÁÆóÁ≤æÂ∫¶**: ËàáÁõ¥Êé•ÂÖ¨ÂºèË®àÁÆóÂÆåÂÖ®Áõ∏Âêå

### üß† Êô∫ËÉΩË®òÊÜ∂È´îÁÆ°ÁêÜÁ≠ñÁï•

#### 1. Â§öÂ±§Á¥öÁ∑©Â≠òÊû∂Êßã
```python
# ‰∏âÂ±§Á∑©Â≠òÁ≥ªÁµ±Ë®≠Ë®à
class MTFExperimentManager:
    def __init__(self):
        # Layer 1: MTF Êü•Ë°® (ÂÖ®Âüü, 2KB)
        self.mtf_lookup_table = initialize_mtf_lookup_table()
        
        # Layer 2: Numpy ÂúñÁâáÁ∑©Â≠ò (20ÂºµÂúñÁâá, ~150MB)
        self.stimulus_cache = StimulusCache(max_size=20)
        
        # Layer 3: Base64 Â≠ó‰∏≤Á∑©Â≠ò (5ÂºµÂúñÁâá, ~40MB)
        self.base64_cache = {}  # LRU managed
```

#### 2. Ëá™ÂãïË®òÊÜ∂È´îÊ∏ÖÁêÜÊ©üÂà∂
- **LRU Ê∑òÊ±∞Á≠ñÁï•**: Ëá™ÂãïÁßªÈô§ÊúÄÂ∞ë‰ΩøÁî®ÁöÑÁ∑©Â≠òÈ†ÖÁõÆ
- **Ë®òÊÜ∂È´îÈñæÂÄºÁõ£Êéß**: Á∑©Â≠òÂ§ßÂ∞èÈôêÂà∂Èò≤Ê≠¢Ë®òÊÜ∂È´îÁ©çÁ¥Ø
- **ÂØ¶È©óÁµêÊùüÊ∏ÖÁêÜ**: Ëá™ÂãïÊ∏ÖÁ©∫ÊâÄÊúâÁ∑©Â≠òÈáãÊîæË®òÊÜ∂È´î

```python
def _evict_base64_lru(self):
    # ÁßªÈô§‰ΩøÁî®Ê¨°Êï∏ÊúÄÂ∞ëÁöÑÈ†ÖÁõÆ
    lru_key = min(self.base64_cache_access.keys(), 
                 key=lambda k: self.base64_cache_access[k])
    del self.base64_cache[lru_key]
    print(f"üóëÔ∏è Evicted base64 cache: {evicted_size//1024}KB freed")
```

### üìä Á≥ªÁµ±ÊÄßËÉΩÊï∏ÊìöÁ∏ΩÁµê

#### MTF ËôïÁêÜÊÄßËÉΩÂ∞çÊØî
| ËôïÁêÜÈöéÊÆµ | ÂÇ≥Áµ±ÊñπÊ≥ï | v0.4 Êü•Ë°®Á≥ªÁµ± | ÊîπÂñÑÂÄçÊï∏ |
|---------|---------|--------------|---------|
| MTF ÂèÉÊï∏Ë®àÁÆó | ÊØèÊ¨° 5-10ms | È†êÂª∫ <0.1ms | **50-100x** |
| Base64 Á∑®Á¢º | ÊØèÊ¨° 1-3s | Á∑©Â≠ò <1ms | **1000-3000x** |
| Á∏ΩËºâÂÖ•ÊôÇÈñì | 10-15s | 2-3s | **3-5x** |

#### Ë®òÊÜ∂È´î‰ΩøÁî®ÂàÜÊûê
- **MTF Êü•Ë°®**: 2KB (21 ÂÄãÊï∏ÊìöÈªû)
- **Numpy Á∑©Â≠ò**: ÊúÄÂ§ö 150MB (20 Âºµ 1200x1200 ÂúñÁâá)
- **Base64 Á∑©Â≠ò**: ÊúÄÂ§ö 40MB (5 ÂºµÁ∑®Á¢ºÂ≠ó‰∏≤)
- **Á∏ΩË®òÊÜ∂È´îÂ≥∞ÂÄº**: ~200MB (Ëá™ÂãïÁÆ°ÁêÜ)

#### Á∂≤È†ÅËºâÂÖ•ÈÄüÂ∫¶ÂÑ™ÂåñÁµêÊûú
- **ÂØ¶È©óÂàùÊúü**: 2-3 Áßí (Êü•Ë°®È†êÂª∫ + ÂàùÊ¨°Á∑®Á¢º)
- **ÂØ¶È©ó‰∏≠Êúü**: <1 Áßí (Á∑©Â≠òÂëΩ‰∏≠Áéá >80%)
- **ÂØ¶È©óÂæåÊúü**: <0.5 Áßí (ÂÆåÂÖ®Á∑©Â≠òÂëΩ‰∏≠)

### üî¨ ÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÊ®ôÊ∫ñÁ¨¶ÂêàÊÄß

#### ÁßëÂ≠∏Ê∫ñÁ¢∫ÊÄß‰øùË≠â
- **MTF Ë®àÁÆóÁ≤æÂ∫¶**: ËàáÊ®ôÊ∫ñÂÖâÂ≠∏ÂÖ¨ÂºèÂÆåÂÖ®‰∏ÄËá¥
- **È°ØÁ§∫Âô®Ê†°Ê∫ñ**: ÂãïÊÖãÈÅ©Êáâ‰∏çÂêåÈ°ØÁ§∫Âô®ÂèÉÊï∏
- **ÊôÇÈñìÁ≤æÂ∫¶**: Á≤æÁ¢∫Âà∞ÊØ´ÁßíÁöÑÂà∫ÊøÄÂëàÁèæÊôÇÈñìË®òÈåÑ
- **Êï∏ÊìöÂÆåÊï¥ÊÄß**: ÊâÄÊúâË©¶Ê¨°ÁöÑ MTF ÂèÉÊï∏ÂíåÂèçÊáâÊôÇÈñìÂÆåÊï¥Ë®òÈåÑ

#### ÂØ¶È©óÈáçÁèæÊÄßÁ¢∫‰øù
- **ÂèÉÊï∏‰∏ÄËá¥ÊÄß**: Áõ∏Âêå MTF ÂÄº‰øùË≠âÁî¢ÁîüÁõ∏ÂêåË¶ñË¶∫Âà∫ÊøÄ
- **Ë∑®Ë®≠ÂÇôÁõ∏ÂÆπÊÄß**: Ëá™ÂãïÈÅ©Êáâ‰∏çÂêåËû¢ÂπïËß£ÊûêÂ∫¶Âíå DPI
- **ÁµêÊûúÂèØËøΩÊ∫ØÊÄß**: ÂÆåÊï¥Ë®òÈåÑÊâÄÊúâËôïÁêÜÂèÉÊï∏ÂíåÊºîÁÆóÊ≥ïÁâàÊú¨

ÈÄôÂÄãÁ≥ªÁµ±Âú®‰øùË≠âÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÁßëÂ≠∏Ê∫ñÁ¢∫ÊÄßÁöÑÂêåÊôÇÔºåÈÄöÈÅéÂ§öÂ±§Á¥öÁ∑©Â≠òÂíåÊô∫ËÉΩÈ†êËôïÁêÜÊ©üÂà∂ÔºåÂ∞áÁ∂≤È†ÅËºâÂÖ•ÈÄüÂ∫¶ÂÑ™ÂåñËá≥Êé•ËøëÊ°åÈù¢ÊáâÁî®Á®ãÂºèÁöÑÊ∞¥Ê∫ñÔºåÁÇ∫Á∑ö‰∏äÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÊèê‰æõ‰∫ÜÁêÜÊÉ≥ÁöÑÊäÄË°ìÂü∫Á§é„ÄÇ

---

## ü§ù Human-AI Collaboration Development Log

ÈÄôÂÄãÂçÄÂ°äË®òÈåÑ‰∫∫Ê©üÂçî‰ΩúÁöÑÈñãÁôºÈÅéÁ®ãÔºåÁî®ÊñºËøΩËπ§ÈúÄÊ±Ç„ÄÅÁ≠ñÁï•„ÄÅÊ±∫Á≠ñÂíåË≤¢ÁçªÂàÜÈÖçÔºå‰æøÊñºÊú™‰æÜÂàÜÊûêÂçî‰ΩúÊ®°Âºè„ÄÇ

### üîÑ Historical Sessions (Reconstructed)

*‰ª•‰∏ãË®òÈåÑÂü∫ÊñºÁèæÊúâÁ®ãÂºèÁ¢º„ÄÅË®ªÈáãÂíåÊñá‰ª∂Êé®Â∞éÈáçÂª∫ÔºåÊ®ôË®ª‰∫Ü‰∏ªË¶ÅÁöÑÊû∂ÊßãÊ±∫Á≠ñÂíåÊäÄË°ìÈáåÁ®ãÁ¢ë„ÄÇ*

### üìã Session 2025-08-001 (Reconstructed)
**Time**: 2025-08-XX (Êé®Ê∏¨ÔºåÂü∫Êñº"August 2025"Ë®ªÈáã)  
**Duration**: Â§öÊ¨°Âçî‰Ωú  
**Tags**: #performance #algorithm #mtf-processing

**üë§ User Request**: 
MTFËôïÁêÜÈÄüÂ∫¶Â§™ÊÖ¢ÔºåÈúÄË¶ÅÂæûÁõ¥Êé•Ë®àÁÆóÊîπÁÇ∫È´òÊïàËÉΩÁöÑÊü•Ë°®Á≥ªÁµ±ÔºåÊèêÂçáÂØ¶È©óÈ´îÈ©ó

**ü§ñ AI Strategy**: 
1. ÂàÜÊûêMTFÂÖ¨ÂºèÔºåÂª∫Á´ãÈ†êË®àÁÆóÁöÑlookup tableÁ≥ªÁµ±
2. ÂØ¶‰ΩúÂãïÊÖãÂèÉÊï∏Ë®àÁÆóÔºåÂü∫ÊñºÂØ¶ÈöõÈ°ØÁ§∫Âô®Ë¶èÊ†º
3. Âª∫Á´ãÂÖ®ÂüüÂø´ÂèñÊ©üÂà∂ÔºåÈÅøÂÖçÈáçË§áË®àÁÆó

**üë§ User Decision & Feedback**:
- ‚úÖ ÊâπÂáÜÂæûÁõ¥Êé•Ë®àÁÆóËΩâÊèõÁÇ∫lookup tableÁ≠ñÁï•
- ‚úÖ Ë¶ÅÊ±Ç‰øùÊåÅËàá[OE] MTF_test_v0.4.pyÁöÑÂÆåÂÖ®‰∏ÄËá¥ÊÄß
- ‚úÖ Âº∑Ë™øÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÁöÑÁ≤æÁ¢∫Â∫¶‰∏çÂèØÂ¶•Âçî

**‚öôÔ∏è Implementation**:
- **AI**: Âª∫Á´ã`initialize_mtf_lookup_table()`Á≥ªÁµ± (150+ LOC)
- **AI**: ÂØ¶‰ΩúÂãïÊÖãÂèÉÊï∏Ë®àÁÆó`calculate_dynamic_mtf_parameters()` (50 LOC)
- **AI**: Êï¥Âêà21ÂÄãÁ≤æÁ¢∫Êï∏ÊìöÈªûÁöÑÈ†êË®àÁÆóË°® (Áâ©ÁêÜÂÖ¨ÂºèÂü∫Á§é)
- **User**: È©óË≠âMTFÁÆóÊ≥ïÊ∫ñÁ¢∫ÊÄßÔºåÁ¢∫‰øùÁßëÂ≠∏ÂØ¶È©óÊ®ôÊ∫ñ

**üìä Outcome**: 
‚úÖ MTFËôïÁêÜÊïàËÉΩÊèêÂçá50-100ÂÄç (5-10ms ‚Üí <0.1ms)  
‚úÖ ‰øùÊåÅËàáÊ®ôÊ∫ñÂÖâÂ≠∏ÂÖ¨ÂºèÂÆåÂÖ®‰∏ÄËá¥ÁöÑÁ≤æÁ¢∫Â∫¶  
‚úÖ Âª∫Á´ãÂÖ®ÂüüÂø´ÂèñÁ≥ªÁµ±ÔºåÂØ¶È©óÊúüÈñìÈõ∂ÈáçË§áË®àÁÆó

**üèÜ Contribution Analysis**:
- **User (20%)**: ÊïàËÉΩÈúÄÊ±ÇË≠òÂà•„ÄÅÁ≤æÁ¢∫Â∫¶Ë¶ÅÊ±Ç„ÄÅÁßëÂ≠∏È©óË≠â
- **AI (80%)**: ÁÆóÊ≥ïË®≠Ë®à„ÄÅlookup tableÂØ¶‰Ωú„ÄÅÊïàËÉΩÂÑ™Âåñ

### üìã Session 2025-07-001 (Reconstructed)
**Time**: 2025-07-XX (Êé®Ê∏¨ÔºåÂü∫ÊñºÈáçÊßãË®ªÈáã)  
**Duration**: Â§ßÂûãÈáçÊßãÂ∞àÊ°à  
**Tags**: #refactoring #architecture #maintainability

**üë§ User Request**: 
ÂñÆ‰∏ÄÂ§ßÊ™îÊ°à(2,174Ë°å)Èõ£‰ª•Á∂≠Ë≠∑ÔºåÈúÄË¶ÅÈáçÊßãÁÇ∫Ê®°ÁµÑÂåñÊû∂ÊßãÔºåÊèêÂçáÈñãÁôºÊïàÁéá

**ü§ñ AI Strategy**: 
1. ÂàÜÊûêÂ∑®ÂûãÊ™îÊ°àÁµêÊßãÔºåË≠òÂà•ÂäüËÉΩÈÇäÁïå
2. Ë®≠Ë®àÂàÜÂ±§Ê®°ÁµÑÊû∂ÊßãÔºöcore/ ui/ experiments/
3. Âª∫Á´ãÊ∏ÖÊô∞ÁöÑË≤¨‰ªªÂàÜÈõ¢Âíå‰ªãÈù¢ÂÆöÁæ©

**üë§ User Decision & Feedback**:
- ‚úÖ ÊâπÂáÜÊ®°ÁµÑÂåñÊû∂ÊßãË®≠Ë®à
- ‚úÖ Ë¶ÅÊ±Ç‰øùÊåÅÂØ¶È©óÂäüËÉΩÂÆåÂÖ®‰∏çËÆä
- ‚úÖ Âº∑Ë™øÂèØËÆÄÊÄßÂíåÂèØÁ∂≠Ë≠∑ÊÄßÂÑ™ÂÖà

**‚öôÔ∏è Implementation**:
- **AI**: Âª∫Á´ãcore/session_manager.pyÈõÜ‰∏≠ÁãÄÊÖãÁÆ°ÁêÜ (200+ LOC)
- **AI**: ÈáçÊßãui/screens/ÁÇ∫Áç®Á´ãÁï´Èù¢Ê®°ÁµÑ (500+ LOC)
- **AI**: ÊèêÂèñui/components/ÂèØÈáçÁî®ÂÖÉ‰ª∂ (300+ LOC)
- **AI**: ‰∏ªÁ®ãÂºèapp.pyÁ≤æÁ∞°ÁÇ∫135Ë°åË∑ØÁî±Âô®
- **User**: Êû∂ÊßãÊ±∫Á≠ñÊåáÂ∞é„ÄÅÊ®°ÁµÑÈÇäÁïåÂÆöÁæ©„ÄÅÂäüËÉΩÈ©óË≠â

**üìä Outcome**: 
‚úÖ Á®ãÂºèÁ¢ºÂæûÂ∑®Âûã2,174Ë°åÈáçÊßãÁÇ∫Ê∏ÖÊô∞Ê®°ÁµÑÊû∂Êßã  
‚úÖ ‰∏ªÁ®ãÂºèÁ≤æÁ∞°ÁÇ∫135Ë°åÔºåÂèØËÆÄÊÄßÂ§ßÂπÖÊèêÂçá  
‚úÖ Âª∫Á´ãÂèØÈáçÁî®ÂÖÉ‰ª∂Â∫´ÔºåÈñãÁôºÊïàÁéáÊèêÂçá  
‚úÖ ‰øùÊåÅÊâÄÊúâÂØ¶È©óÂäüËÉΩ100%‰∏ÄËá¥ÊÄß

**üèÜ Contribution Analysis**:
- **User (30%)**: Êû∂ÊßãÈ°òÊôØ„ÄÅÈáçÊßãÊ±∫Á≠ñ„ÄÅÂìÅË≥™Ê®ôÊ∫ñÂà∂ÂÆö
- **AI (70%)**: Á®ãÂºèÁ¢ºÈáçÊßã„ÄÅÊ®°ÁµÑË®≠Ë®à„ÄÅÂäüËÉΩÈÅ∑Áßª

### üìã Session 2025-06-001 (Reconstructed)
**Time**: 2025-06-XX (Êé®Ê∏¨ÔºåÂü∫ÊñºÂø´ÂèñÁ≥ªÁµ±Ë®ªÈáã)  
**Duration**: ÊïàËÉΩÂÑ™ÂåñÂ∞àÊ°à  
**Tags**: #performance #caching #user-experience

**üë§ User Request**: 
Á∂≤È†ÅËºâÂÖ•ÊôÇÈñì10-15ÁßíÂ§™Èï∑ÔºåÂΩ±ÈüøÂØ¶È©óÈ´îÈ©óÔºåÈúÄË¶ÅÂ§ßÂπÖÊîπÂñÑËºâÂÖ•ÈÄüÂ∫¶

**ü§ñ AI Strategy**: 
1. ÂàÜÊûêËºâÂÖ•Áì∂È†∏ÔºöÈáçË§áÁöÑBase64Á∑®Á¢ºÊòØ‰∏ªË¶ÅÂïèÈ°å
2. Ë®≠Ë®àÂ§öÂ±§Á¥öÂø´ÂèñÔºöBase64Âø´Âèñ + NumpyÂø´Âèñ + MTFÊü•Ë°®
3. Âª∫Á´ãÈ†êÁîüÊàêÊ©üÂà∂ÔºåÂú®Âõ∫Ë¶ñÊúüÈñìÈ†êÂÇô‰∏ã‰∏ÄÂºµÂúñÁâá

**üë§ User Decision & Feedback**:
- ‚úÖ ÊâπÂáÜÂ§öÂ±§Á¥öÂø´ÂèñÊû∂Êßã
- ‚úÖ Ë¶ÅÊ±ÇÂú®ÂøÉÁêÜÁâ©ÁêÜÂØ¶È©ó‰∏≠‰øùÊåÅÊôÇÈñìÁ≤æÁ¢∫Â∫¶
- ‚úÖ Âº∑Ë™ø‰∏çÂèØÂΩ±ÈüøÂà∫ÊøÄÂëàÁèæÁöÑÁßëÂ≠∏Ê∫ñÁ¢∫ÊÄß

**‚öôÔ∏è Implementation**:
- **AI**: Âª∫Á´ãBase64È†êÁ∑®Á¢ºÂø´ÂèñÁ≥ªÁµ± (100+ LOC)
- **AI**: ÂØ¶‰ΩúLRUË®òÊÜ∂È´îÁÆ°ÁêÜÊ©üÂà∂ (80 LOC)
- **AI**: Âª∫Á´ãÂõ∫Ë¶ñÊúüÈñìÈ†êÁîüÊàêÈÇèËºØ (60 LOC)
- **AI**: Êï¥Âêà‰∏âÂ±§Âø´ÂèñÊû∂ÊßãÂà∞ÂØ¶È©óÊµÅÁ®ã
- **User**: ÊïàËÉΩÈúÄÊ±ÇÂÆöÁæ©„ÄÅ‰ΩøÁî®ËÄÖÈ´îÈ©óÈ©óÊî∂

**üìä Outcome**: 
‚úÖ ËºâÂÖ•ÊôÇÈñìÂæû10-15ÁßíÂ§ßÂπÖÊ∏õÂ∞ëÂà∞2-3Áßí (3-5ÂÄçÊîπÂñÑ)  
‚úÖ Base64Á∑®Á¢ºÊïàËÉΩÊèêÂçá1000-3000ÂÄç (Âø´ÂèñÂëΩ‰∏≠ÊôÇ)  
‚úÖ Âª∫Á´ãÊô∫ËÉΩË®òÊÜ∂È´îÁÆ°ÁêÜÔºåÂ≥∞ÂÄº~200MBËá™ÂãïÊéßÂà∂  
‚úÖ ‰øùÊåÅÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÊØ´ÁßíÁ¥öÊôÇÈñìÁ≤æÁ¢∫Â∫¶

**üèÜ Contribution Analysis**:
- **User (25%)**: ÊïàËÉΩÂïèÈ°åË≠òÂà•„ÄÅ‰ΩøÁî®ËÄÖÈúÄÊ±Ç„ÄÅÁßëÂ≠∏Ê®ôÊ∫ñÂ†ÖÊåÅ
- **AI (75%)**: Âø´ÂèñÁ≥ªÁµ±Ë®≠Ë®à„ÄÅÊïàËÉΩÂÑ™ÂåñÂØ¶‰Ωú„ÄÅË®òÊÜ∂È´îÁÆ°ÁêÜ

### üìã Session 2025-05-001 (Reconstructed)
**Time**: 2025-05-XX (Êé®Ê∏¨ÔºåÂü∫Êñºpixel-perfectÁ≥ªÁµ±)  
**Duration**: È°ØÁ§∫Á≤æÁ¢∫Â∫¶Â∞àÊ°à  
**Tags**: #display #pixel-perfect #scientific-accuracy

**üë§ User Request**: 
ÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÈúÄË¶ÅÂÉèÁ¥†ÂÆåÁæéÁöÑÂà∫ÊøÄÂëàÁèæÔºå‰ªª‰ΩïÁ∏ÆÊîæÈÉΩÊúÉÁ†¥Â£ûÁßëÂ≠∏Ê∫ñÁ¢∫ÊÄß

**ü§ñ AI Strategy**: 
1. Âª∫Á´ãCSS pixel-perfectÊ∏≤ÊüìÁ≥ªÁµ±
2. ÂØ¶‰ΩúÂ§öËß£ÊûêÂ∫¶DPIÊîØÊè¥ (2x, 3x scaling)
3. Âª∫Á´ãÁÄèË¶ΩÂô®ÁâπÂÆöÂÑ™ÂåñÊåáÂçó

**üë§ User Decision & Feedback**:
- ‚úÖ ÊâπÂáÜ1:1ÂÉèÁ¥†ÊØî‰æãÁöÑÁµïÂ∞çË¶ÅÊ±Ç
- ‚úÖ Ë¶ÅÊ±ÇÂª∫Á´ãÂ§öDPIÁí∞Â¢ÉÊîØÊè¥
- ‚úÖ Âº∑Ë™øÁßëÂ≠∏ÂØ¶È©óÁöÑÈ°ØÁ§∫ÂÆåÊï¥ÊÄß

**‚öôÔ∏è Implementation**:
- **AI**: Âª∫Á´ãpixel-perfect CSSÁ≥ªÁµ± (120+ LOC)
- **AI**: ÂØ¶‰ΩúÈ´òDPIÂúñÁâáÈ†êËôïÁêÜÂ∑•ÂÖ∑ (200+ LOC)
- **AI**: Âª∫Á´ãÁÄèË¶ΩÂô®ÂÑ™ÂåñÊåáÂçóÊñá‰ª∂
- **AI**: ÂØ¶‰Ωústimuli_preparation/high_dpi/Á≥ªÁµ±
- **User**: ÁßëÂ≠∏Ê®ôÊ∫ñÂà∂ÂÆö„ÄÅÈ°ØÁ§∫ÂìÅË≥™È©óË≠â

**üìä Outcome**: 
‚úÖ Âª∫Á´ãÂÆåÊï¥ÁöÑÂÉèÁ¥†ÂÆåÁæéÈ°ØÁ§∫Á≥ªÁµ±  
‚úÖ ÊîØÊè¥2x/3xÈ´òDPIËß£ÊûêÂ∫¶Áí∞Â¢É  
‚úÖ Á¢∫‰øùÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÁöÑÈ°ØÁ§∫ÁßëÂ≠∏Ê∫ñÁ¢∫ÊÄß  
‚úÖ Âª∫Á´ãË∑®ÁÄèË¶ΩÂô®ÂÑ™ÂåñÊ®ôÊ∫ñ

**üèÜ Contribution Analysis**:
- **User (35%)**: ÁßëÂ≠∏Ê®ôÊ∫ñÂà∂ÂÆö„ÄÅÁ≤æÁ¢∫Â∫¶Ë¶ÅÊ±Ç„ÄÅÂìÅË≥™È©óË≠â
- **AI (65%)**: ÊäÄË°ìÂØ¶‰Ωú„ÄÅCSSÁ≥ªÁµ±„ÄÅÂ§öDPIÊîØÊè¥

---

### üìã Session 2025-01-13-001
**Time**: 2025-01-13 14:30-15:15 UTC  
**Duration**: 45 mins  
**Tags**: #feature #ui #image-processing

**üë§ User Request**: 
1. ‰øÆÊîπÂúñÁâáË£ÅÂàáÈÇèËºØÔºöstimuli_img.png ‰ΩøÁî®Âè≥‰∏ãËßí1200x1200ÔºåÂÖ∂‰ªñÂúñÁâáÁ∂≠ÊåÅ‰∏≠ÂøÉË£ÅÂàá
2. UI‰ªãÈù¢ÊñáÂ≠óË¶ÅÊîæÂ§ßÂà∞1.5ÂÄçÔºåÊîπÂñÑÂèØËÆÄÊÄß

**ü§ñ AI Strategy**: 
1. ÂàÜÊûêÁèæÊúâ `load_and_prepare_image` ÂáΩÊï∏ÔºåÂª∫Ë≠∞Âü∫ÊñºÊ™îÂêçÊ¢ù‰ª∂Âà§Êñ∑ÁöÑË£ÅÂàáÁ≠ñÁï•
2. Ë®≠Ë®àÁµ±‰∏ÄÁöÑ CSS 1.5x scaling Á≥ªÁµ±ÔºåË¶ÜËìãÊâÄÊúâ Streamlit UI ÂÖÉ‰ª∂
3. ÂàÜÈöéÊÆµÂØ¶ÊñΩÔºöÂÖàÂúñÁâáË£ÅÂàáÔºåÂÜçUIÊîæÂ§ßÔºåÊúÄÂæå‰øÆÊ≠£ÈÅ∫ÊºèÂÖÉÁ¥†

**üë§ User Decision & Feedback**:
- ‚úÖ ÊâπÂáÜÂúñÁâáË£ÅÂàáÂ∑ÆÁï∞ÂåñÁ≠ñÁï•
- ‚úÖ ÂêåÊÑèÁµ±‰∏ÄÁöÑCSS scalingÊñπÊ°à  
- ‚ö†Ô∏è ÊåáÂá∫ÂàùÁâàÂ≠óÈ´îÂ§ßÂ∞èÂè™Êúâ1.2ÂÄçÔºå‰∏çÊòØÁúüÊ≠£ÁöÑ1.5ÂÄçÔºåË¶ÅÊ±Ç‰øÆÊ≠£
- ‚ö†Ô∏è ÁôºÁèæÂØ¶È©óË™™ÊòéÂàóË°®„ÄÅhelpÊèêÁ§∫Á≠âÂÖÉÁ¥†‰ªçÊú™ÊîæÂ§ßÔºåË¶ÅÊ±ÇË£úÂº∑
- ‚úÖ ÊúÄÁµÇÈ©óÊî∂Á¢∫Ë™çÊâÄÊúâ‰ªãÈù¢ÊñáÂ≠óÈÅîÂà∞1.5ÂÄçÊïàÊûú

**‚öôÔ∏è Implementation**:
- **AI**: ‰øÆÊîπ `experiments/mtf_utils.py` ÁöÑÂúñÁâáË£ÅÂàáÈÇèËºØ (25 LOC changed)
- **AI**: Âª∫Á´ã `apply_ui_scaling()` CSSÂáΩÊï∏ÔºåË¶ÜËìãÊåâÈàï„ÄÅÊñáÂ≠ó„ÄÅÊ®ôÈ°å (80 LOC added)
- **AI**: ‰øÆÊ≠£Â≠óÈ´îÂ§ßÂ∞èÂà∞ÁúüÊ≠£1.5ÂÄçÔºö1rem‚Üí1.5rem, H1 2.25rem‚Üí3.375rem Á≠â (50 LOC enhanced)
- **AI**: Ë£úÂº∑ÈÅ∫ÊºèÂÖÉÁ¥†ÔºöÂàóË°®„ÄÅhelpÊèêÁ§∫„ÄÅË®äÊÅØÊ°Ü„ÄÅ‰∏âÊ¨Ñ‰ΩàÂ±ÄÁ≠â (100 LOC added)
- **AI**: Êñ∞Â¢ûÈÄöÁî®ÂÆπÂô®ÈÅ∏ÊìáÂô®ÔºåÁ¢∫‰øùÂÆåÊï¥Ë¶ÜËìã (30 LOC added)
- **User**: ÈúÄÊ±ÇË¶èÊ†ºÂÆöÁæ©„ÄÅÂïèÈ°åÁôºÁèæ„ÄÅÂìÅË≥™È©óË≠â„ÄÅÊîπÈÄ≤ÊåáÂ∞é

**üìä Outcome**: 
‚úÖ ÊàêÂäüÂØ¶ÁèæÂ∑ÆÁï∞ÂåñÂúñÁâáË£ÅÂàáÔºöstimuli_img.png Âè≥‰∏ãËßíÔºåÂÖ∂‰ªñÂúñÁâá‰∏≠ÂøÉ  
‚úÖ ÊâÄÊúâUIÊñáÂ≠óÂÖÉÁ¥†ÊîæÂ§ßËá≥ÁúüÊ≠£1.5ÂÄç (16px‚Üí24px, 36px‚Üí54pxÁ≠â)  
‚úÖ ‰øùÊåÅÂøÉÁêÜÁâ©ÁêÜÂØ¶È©óÁöÑ1:1ÂÉèÁ¥†Á≤æÁ¢∫Â∫¶  
‚úÖ ‰ªãÈù¢ÂèØËÆÄÊÄßÂ§ßÂπÖÊèêÂçáÔºåÈÅ©ÂêàÂØ¶È©ó‰ΩøÁî®

**üèÜ Contribution Analysis**:
- **User (25%)**: ÂâµÊÑèÈúÄÊ±ÇÊèêÂá∫„ÄÅÁ¥∞ÁØÄÂïèÈ°åÁôºÁèæ„ÄÅÂìÅË≥™ÊääÈóú„ÄÅÂ§öËº™ÊîπÈÄ≤ÊåáÂ∞é
- **AI (75%)**: ÊäÄË°ìÊñπÊ°àË®≠Ë®à„ÄÅÁ®ãÂºèÁ¢ºÂØ¶Áèæ„ÄÅÊ∏¨Ë©¶È©óË≠â„ÄÅÂÖ®Èù¢ÂÖÉ‰ª∂Ë¶ÜËìã

**üîó Related Files**: 
- `experiments/mtf_utils.py` - ÂúñÁâáË£ÅÂàáÈÇèËºØ
- `ui/components/response_buttons.py` - UI scaling CSSÁ≥ªÁµ±
- All `ui/screens/*.py` - Â•óÁî®scalingÂà∞ÂêÑÁï´Èù¢

**üìù Lessons Learned**:
- CSSÈÅ∏ÊìáÂô®ÈúÄË¶ÅÂ§öÂ±§‰øùË≠∑ÊâçËÉΩÂÆåÂÖ®Ë¶ÜËìãStreamlitÂÖßÈÉ®ÂÖÉ‰ª∂
- Áî®Êà∂ÁöÑÂìÅË≥™È©óË≠âÂíåÁ¥∞ÁØÄË¶ÅÊ±ÇÂ∞çÊúÄÁµÇÊïàÊûúËá≥ÈóúÈáçË¶Å
- ÂàÜÈöéÊÆµÂØ¶ÊñΩÊúâÂä©ÊñºÈÄêÊ≠•ÂÆåÂñÑÂäüËÉΩ

---

#### Todo
~~1. ÊàëÂøòË®òÁãóÁãóÈÇ£ÂºµÂúñÂè™ÊúâÂè≥ÈÇäÊúâ‰∏ªËßíÔºåË¶Å‰øÆÊîπÊì∑Âèñ‰ΩçÁΩÆ~~ ‚úÖ Completed (Session 2025-01-13-001)
~~2. UI Ë¶ÅÊîπÊàê1.5xÂ§ßÔºå‰∏çÁÑ∂Áúã‰∏çÂà∞~~ ‚úÖ Completed (Session 2025-01-13-001)  
~~3. Êîπ claude.md ËÆì‰ªñËá™ÂãïÂπ´ÊàëÂØ´dev log~~ ‚úÖ Completed (Session 2025-01-13-001)